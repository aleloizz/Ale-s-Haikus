<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#1e142c">
        <meta name="robots" content="index, follow">
        <meta name="description" content="Crea e verifica haiku, tanka e tante altre forme poetiche con questo avanzato analizzatore metrico. Lasciati ispirare e libera il poeta che è in tè.">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ale's Haikus">
    <meta property="og:description" content="Analizzatore avanzato per poesie di ogni tipo">
    <meta property="og:image" content="https://www.aleshaikus.me/static/og-image.jpg">
    <meta property="og:image:secure_url" content="https://www.aleshaikus.me/static/og-image.jpg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Anteprima di Ale's Haikus con logo e sfondo sfumato.">
    <meta property="og:site_name" content="Ale's Haikus">
    <meta property="og:url" content="https://www.aleshaikus.me/analizzatore">
    <link rel="canonical" href="https://www.aleshaikus.me/analizzatore">
    <meta name="twitter:card" content="summary_large_image">
        <!-- iOS PWA Meta -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="Ale's Haikus">
        <meta name="format-detection" content="telephone=no">
        
        <title>Ale's Haikus | analizza le tue migliori poesie</title>
    
        <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}?v=1.4">
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}?v=1.4">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}?v=1.4">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}?v=1.4">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ url_for('static', filename='favicon-96x96.png') }}?v=1.4">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='android-chrome-192x192.png') }}?v=1.4">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='android-chrome-512x512.png') }}?v=1.4">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}?v=1.4">
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}?v=1.8">
    <meta name="msapplication-TileColor" content="#faf7ff">
    <meta name="msapplication-config" content="{{ url_for('static', filename='browserconfig.xml') }}?v=1.4">
    <meta name="theme-color" content="#1e142c">
    
    <script>document.documentElement.classList.add('js');</script>
    <!-- Critical Above-the-fold CSS - Inline per zero blocking -->
        <style>
/* Above-the-fold Critical CSS */
:root{--primary:#D4B8FF;--secondary:#FFE5D9;--accent:#A2D7D8;--text:#5E5E5E;--bg:#FAF7FF}
*{box-sizing:border-box}
body{font-family:'Inter',sans-serif;margin:0;padding:0;min-height:100vh;display:flex;flex-direction:column}
.main-wrapper{flex:1;display:flex;flex-direction:column}
.container{width:100%;max-width:1140px;margin:0 auto;padding:0 0.75rem}
.bg-haiku-primary{background:transparent!important;backdrop-filter:none!important;-webkit-backdrop-filter:none!important;border:none!important;box-shadow:none!important}
.text-white{color:#fff!important}.text-center{text-align:center!important}
.py-5{padding:3rem 0!important}
.display-4{font-size:calc(1.475rem + 2.7vw);font-weight:300;line-height:1.2;margin:0}
.lead{font-size:1.25rem;font-weight:300;margin-bottom:1rem}
.btn-more{display:inline-block;padding:0.9rem 2.4rem;border:40px solid transparent;border-radius:40px;color:white;text-decoration:none;font-weight:600;cursor:pointer;transition:all 0.3s ease;backdrop-filter:blur(10px);font-size:1.15rem;min-height:54px;background:linear-gradient(rgba(255,255,255,0.2),rgba(255,255,255,0.2)) padding-box,linear-gradient(135deg,#cca9ff 0%,#ffb18d 100%) border-box;background-origin:padding-box, border-box;background-clip:padding-box, border-box}
.card{background:rgba(255,255,255,0.95);border-radius:1rem;padding:2rem;box-shadow:0 1rem 3rem rgba(0,0,0,0.175);border:none;margin:2rem auto;max-width:600px}
.h2{font-size:calc(1.325rem + 0.9vw);margin-bottom:1.5rem}
.form-control,.form-select{display:block;width:100%;padding:0.75rem;font-size:1rem;border:1px solid #ced4da;border-radius:0.375rem;background:#fff}
.form-select{
    padding:0.375rem 2.25rem 0.375rem 0.75rem;
    -webkit-appearance:none;
    -moz-appearance:none;
    appearance:none;
    background-image:none!important;
    background-repeat:no-repeat!important;
}
select::-ms-expand{display:none}
.mb-3{margin-bottom:1rem!important}.mb-4{margin-bottom:1.5rem!important}
.d-flex{display:flex!important}.justify-content-center{justify-content:center!important}
.gap-2{gap:0.5rem!important}
.btn-haiku{transition:all 0.3s ease;border-radius:2rem!important;padding:10px 16px!important;font-size:1rem!important;line-height:1.5!important;min-height:44px!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;white-space:nowrap!important;font-weight:500!important}
.btn-haiku i{margin-right:.5rem;display:inline-block;line-height:0}
.btn-haiku.btn-primary{background:var(--primary);border:none}
.btn-haiku.btn-secondary{background:var(--secondary);color:var(--text);border:none}
body.loading{background:#fbbda3!important}

/* Instant Loading Overlay (shows only if JS enabled) */
.app-loader{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:2000;color:#fff}
.js .app-loader{display:flex}
.app-loader__backdrop{position:absolute;inset:0;background:linear-gradient(135deg,#cca9ff 0%,#ffb18d 100%)}
.app-loader__content{position:relative;display:flex;flex-direction:column;align-items:center;gap:.75rem;padding:1rem 1.25rem;border-radius:14px;background:rgba(255,255,255,0.12);backdrop-filter:blur(8px);box-shadow:0 10px 30px rgba(0,0,0,0.08)}
.app-loader__logo{width:40px;height:40px;border-radius:10px;box-shadow:0 2px 12px rgba(160,132,232,0.18);background:#fff}
.app-loader__spinner{width:28px;height:28px;border:3px solid rgba(255,255,255,0.35);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
.app-loader__text{font-size:.95rem;opacity:.9}
.app-loader--hidden{opacity:0;transition:opacity .28s ease;pointer-events:none}
@keyframes spin{to{transform:rotate(360deg)}}
@media (prefers-reduced-motion: reduce){.app-loader__spinner{animation:none;border-top-color:transparent}.app-loader__text{opacity:1}}

/* Custom select chevron positioning (keep only colored icon) */
.select-icon{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);pointer-events:none;color:#a084e8}

/* Safe-area padding for toasts on iOS */
.toast-container.position-fixed{padding-bottom:calc(1rem + env(safe-area-inset-bottom));padding-right:calc(1rem + env(safe-area-inset-right))}

/* ===== FLEXIBLE LAYOUT (replaces earlier rigid CLS prevention) ===== */
@media (min-width: 992px) {
    .card {
        /* Allow natural height growth while keeping an initial reserved space */
        min-height: clamp(520px, 60vh, 780px);
        width: 100%;
        max-width: 640px; /* a bit wider breathing room */
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }
    .card-body {
        display: flex;
        flex-direction: column;
    }
}

/* Reserve exact space for pattern display */
#patternDisplay{
    /* Allow wrapping without forcing fixed height; reserve minimal space */
    min-height: 50px;
    display: flex!important;
    justify-content: center!important;
    align-items: center;
    flex-wrap: wrap;
    gap: .5rem;
}

/* Syllable / pattern badges (flexible now, support multi-word like "versi liberi") */
.badge.syllable-badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:0 .75rem;
    min-height:32px;
    line-height:1.1;
    font-size:0.82rem;
    font-weight:600;
    border-radius:16px;
    white-space:nowrap;
    max-width:100%;
}

/* Fixed form select dimensions */
.form-select-container {
    /* Let container adapt to content while keeping approximate baseline */
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: .75rem;
}

/* Textarea fixed height to prevent shift */
#poemText {
    min-height: 150px; /* starting comfort */
    height: auto; /* grow with content */
    resize: vertical; /* user can still resize if desired */
}

/* Publish fields expansion (fluid) */
#publishFields{
    overflow:visible;
    transition:opacity .25s ease, transform .25s ease;
    opacity:1;
}
#publishFields[style*="display: none"]{opacity:0;transform:translateY(-4px);height:0!important;margin:0!important;padding-top:0!important;padding-bottom:0!important}
#publishFields[style*="display: block"]{opacity:1;transform:translateY(0);height:auto!important;}

/* Main area adapts; rely on natural document flow */
@media (min-width: 992px) {
    main{
        min-height: calc(100vh - 350px); /* keep approximate above-fold presence */
    }
}

/* Result container: allow expansion without inner scrollbars */
#resultContainer {
    min-height: 80px;
}

/* Font display optimizations */
@font-face{
  font-family:'Inter';
  font-display: swap;
  src: local('Inter');
}
@font-face{
  font-family:'Playfair Display';
  font-display: swap;
  src: local('Playfair Display');
}

/* Prevent initial font flash */
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* Rimuovi highlight solo su touch */
@media (pointer: coarse) {
  html, body, a, button, .btn { -webkit-tap-highlight-color: transparent; }
  /* Feedback alternativo al tocco */
  a:active, button:active, .btn:active {
    filter: brightness(0.95);
    transform: translateY(0.5px);
    transition: filter 120ms ease, transform 120ms ease;
  }
}

/* Mantieni focus visibile per tastiera */
a:focus-visible, button:focus-visible, .btn:focus-visible {
  outline: 2px solid #a084e8;
  outline-offset: 2px;
}

/* Mobile tweaks */
@media (max-width: 576px){
    .header-content{padding-top:2.25rem!important;padding-bottom:2.25rem!important}
    #patternDisplay{min-height:44px;gap:.35rem}
    .form-select-container{min-height:auto}
    .btn-more{font-size:1.2rem;padding:1rem 2.6rem;min-height:56px}
}
</style>

        <!-- Preload essential resources -->
    <link rel="preload" href="{{ url_for('static', filename='css/critical.css') }}?v=1.3" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/critical.css') }}?v=1.3"></noscript>
        
        <!-- Async load non-critical CSS -->
    <link rel="preload" href="{{ url_for('static', filename='css/main.css') }}?v=1.42" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}?v=1.42"></noscript>

    <!-- Icons - load async (local subset) -->
    <link rel="preload" href="{{ url_for('static', filename='css/icons.css') }}?v=2.3" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/icons.css') }}?v=2.3"></noscript>
    <!-- Fallback: Bootstrap Icons full set (lazy) to cover any missing classes -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"></noscript>

        <style>
            /* Prefer font-based Bootstrap Icons on this page to inherit color properly */
            .bi[class^="bi-"]::before,
            .bi[class*=" bi-"]::before { background-image: none !important; }
        </style>

    <!-- Preload main module early to avoid ESM fetch latency in LCP chain -->
    <link rel="modulepreload" href="{{ url_for('static', filename='js/main.js') }}?v=1.3.8">

        <!-- Fonts - optimized loading with font-display: swap and preload -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <!-- Preconnect for JS CDN used later (Bootstrap JS lazy-loaded) -->
        <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
        
        <!-- Critical font preload per evitare FOIT/FOUT e ridurre CLS -->
        <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2" as="font" type="font/woff2" crossorigin>
        
        <!-- Google Fonts con font-display: swap per evitare invisible text e CLS -->
        <style>
        /* Inline critical font styles per eliminare request blocking */
        @font-face {
          font-family: 'Inter';
          font-style: normal;
          font-weight: 300;
          font-display: swap;
          src: url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5nw.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        @font-face {
          font-family: 'Inter';
          font-style: normal;
          font-weight: 400;
          font-display: swap;
          src: url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        @font-face {
          font-family: 'Inter';
          font-style: normal;
          font-weight: 500;
          font-display: swap;
          src: url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5nw.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        @font-face {
          font-family: 'Playfair Display';
          font-style: italic;
          font-weight: 400;
          font-display: swap;
          src: url(https://fonts.gstatic.com/s/playfairdisplay/v36/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvXDYbtXK-F2qC0s.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        </style>
        
        <!-- Fallback async load per compatibilità -->
        <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital@0;1&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital@0;1&display=swap"></noscript>

        <!-- CSS Loading Enhancement Script -->
        <script>
        /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
        !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}return i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)}),i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=function(a){for(var c,d=0;d<h.styleSheets.length;d++)h.styleSheets[d].href&&h.styleSheets[d].href.indexOf(b)>-1&&(c=!0);c?a():setTimeout(function(){i.onloadcssdefined(a)})},i.onloadcssdefined(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
        </script>

        <!-- Schema.org markup -->
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "WebApplication",
          "name": "Ale's Poetry Analyzer",
          "applicationCategory": "LiteraryTool",
          "operatingSystem": "Web",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          }
        }
        </script>

        <style>
            body.loading {
              background: #fbbda3 !important;
            }
        </style>

        <!-- Removed rigid CLS prevention script; layout now fluid & content-driven -->

        

    </head>
    
    <body class="loading">
        <!-- Lightweight Loading Overlay -->
        <div id="app-loader" class="app-loader" role="status" aria-live="polite" aria-label="Caricamento applicazione">
            <div class="app-loader__backdrop" aria-hidden="true"></div>
            <div class="app-loader__content">
                <img src="{{ url_for('static', filename='favicon-96x96.png') }}?v=1.2" alt="" class="app-loader__logo" aria-hidden="true">
                <div class="app-loader__spinner" aria-hidden="true"></div>
                <p class="app-loader__text">Caricamento…</p>
            </div>
        </div>
        <script>
        (function(){
          const overlay=document.getElementById('app-loader');
          if(!overlay) return;
                    let hidden=false;
                    const started=performance.now();
                      const MIN_SHOW_MS=500;
                    const hide=()=>{ if(hidden) return; hidden=true; overlay.classList.add('app-loader--hidden'); overlay.addEventListener('transitionend',()=>overlay.remove(),{once:true}); };
                    // Prefer app:ready from main.js; fallback to load; hard timeout safety
                    let t=setTimeout(hide, 4000);
                    const done=()=>{
                        clearTimeout(t);
                        const elapsed=performance.now()-started;
                        const wait=Math.max(0, MIN_SHOW_MS - elapsed);
                        if(wait>0) setTimeout(hide, wait); else hide();
                    };
                    document.addEventListener('app:ready', done, { once:true });
                    document.addEventListener('DOMContentLoaded', done, { once:true });
          window.addEventListener('load', done, { once:true });
        })();
        </script>
        <div class="main-wrapper">
            <script>
                // Rimuove la classe loading quando l'immagine è caricata
                window.addEventListener('load', () => {
                document.body.classList.remove('loading');
                });
            </script>
            <header>
                <!-- Barra navigazione discreta -->
                <nav class="navbar navbar-expand-sm haiku-navbar" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div class="container">
                        <div class="d-flex w-100 justify-content-center">
                            <ul class="navbar-nav haiku-nav">
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{{ url_for('web.analyzer') }}" title="Analizzatore poetico">
                                        <i class="bi bi-pencil-square me-1"></i>Analizza
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{{ url_for('web.bacheca') }}" title="Haiku's hub">
                                        <i class="bi bi-collection me-1"></i>Bacheca
                                        <small style="color: #ff4444;">New!</small>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-white" href="{{ url_for('web.wiki') }}" title="Wiki della poesia">
                                        <i class="bi bi-book me-1"></i>Wiki
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                
                <div class="bg-haiku-primary text-white text-center py-5 header-content">
                    <div class="container">
                    <h1 class="display-4">Benvenuto su Ale's Haikus!</h1>
                    <p class="lead">lo strumento perfetto per controllare la metrica <br> delle tue migliori poesie.</p>
                    <button type="button" class="btn-more" data-bs-toggle="modal" data-bs-target="#aboutModal">
                        Cosa posso scrivere?
                    </button>
                    </div>
                </div>
            </header>

            

                        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index:1080">
                                <div id="copyToast" class="toast" data-bs-delay="2200" aria-live="polite" aria-atomic="true">
                                    <div class="toast-body">Testo copiato! ^_^</div>
                                </div>
                                <div id="errorToast" class="toast toast-error" data-bs-delay="5000" role="alert" aria-live="assertive" aria-atomic="true">
                                    <div class="toast-body d-flex align-items-start gap-2">
                                        <i class="bi bi-x-octagon-fill"></i>
                                        <span class="flex-grow-1" id="errorToastMessage">Errore</span>
                                        <button type="button" class="btn-close btn-close-white ms-2 m-0" data-bs-dismiss="toast" aria-label="Chiudi"></button>
                                    </div>
                                </div>
                        </div>

            <main class="flex-grow-1 py-5">    
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-6 col-md-8">
                            <div class="card shadow-lg border-0">
                                <div class="card-body p-4 p-md-5">
                                    <h2 class="h2 text-white">Cosa scriviamo oggi? :)</h2>
                                    <!-- Selettore tipo poesia -->
                                    <div class="mb-4 text-center form-select-container">
                                        <label class="form-select-label">Nazionalità:</label>
                                        <div class="position-relative mb-2">
                                            <select class="form-select nation-label" id="poemNation">
                                                <option value="giapponesi">Giapponese</option>
                                                <option value="italiane">Italiana</option>
                                                <option value="inglesi">Inglese</option>
                                            </select>
                                            <div class="select-icon"><i class="bi bi-chevron-down"></i></div>
                                        </div>
                                        <label for="poemType" class="form-select-label">Tipo di poesia:</label>
                                        <div class="position-relative">
                                            <select class="form-select type-label" id="poemType">
                                                <!-- Fallback server-side options to avoid empty select before JS initializes -->
                                                <option value="haiku" selected>Haiku</option>
                                                <option value="tanka">Tanka</option>
                                                <option value="katauta">Katauta</option>
                                                <option value="choka">Choka</option>
                                                <option value="sedoka">Sedoka</option>
                                            </select>
                                            <div class="select-icon"><i class="bi bi-chevron-down"></i></div>
                                        </div>
                                    </div>

                                    <!-- Visualizzazione pattern-->
                                    <br>
                                    <div class="d-flex justify-content-center gap-2 mb-4" id="patternDisplay" 
                                         style="height: 60px; min-height: 60px; align-items: center; contain: layout;">
                                        <!-- Fallback badges (Haiku 5-7-5) shown until JS updates -->
                                        <span class="badge bg-haiku-secondary syllable-badge" style="min-width: 40px; height: 32px; line-height: 30px; display: inline-flex; align-items: center; justify-content: center;">5</span>
                                        <span class="badge bg-haiku-secondary syllable-badge" style="min-width: 40px; height: 32px; line-height: 30px; display: inline-flex; align-items: center; justify-content: center;">7</span>
                                        <span class="badge bg-haiku-secondary syllable-badge" style="min-width: 40px; height: 32px; line-height: 30px; display: inline-flex; align-items: center; justify-content: center;">5</span>
                                    </div>

                                    <!-- Textarea unico -->
                                    <form method="POST" id="poemForm" onsubmit="return false;">
                                        <!-- Campi per pubblicazione -->
                                        <div id="publishFields" class="mb-3" style="display: none;">
                                            <div class="row">
                                                <div class="col-md-6 mb-2">
                                                    <input type="text" class="form-control" id="poemTitle" placeholder="Titolo (opzionale)" maxlength="100">
                                                </div>
                                                <div class="col-md-6 mb-2">
                                                    <input type="text" class="form-control" id="poemAuthor" placeholder="Il tuo nome (opzionale)" maxlength="50">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3 position-relative">
                                            <label class="form-label fw-light text-muted mb-2">Inserisci la tua poesia <small class="text-muted">(un verso per riga)</small></label>
                                            <textarea class="form-control border-0 bg-light bg-opacity-10 py-3 px-4 rounded-3 shadow-sm" 
                                                    id="poemText" 
                                                    rows="5" 
                                                    placeholder="Scrivi qui i tuoi versi :3"
                                                    style="min-height: 150px; 
                                                            resize: none; 
                                                            transition: all 0.3s ease;
                                                            backdrop-filter: blur(8px);"
                                                            inputmode="text"
                                                            autocomplete="off"
                                                            autocorrect="off"
                                                            autocapitalize="sentences"
                                                            spellcheck="false"></textarea>
                                            
                                        </div>

                                        <div id="validationMessages" class="mb-3" aria-live="polite" aria-atomic="true"></div>
                                        <!-- Aggiorna i pulsanti -->
                                        <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                                            <div class="d-flex flex-column gap-2">
                                                <!-- Custom animated checkboxes -->
                                                <div class="d-flex flex-column gap-2 text-start align-items-start">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <input type="checkbox" id="publishPoem" class="visually-hidden-checkbox" aria-labelledby="label-publishPoem">
                                                        <label for="publishPoem" class="check" aria-hidden="true">
                                                            <svg width="18" height="18" viewBox="0 0 18 18" aria-hidden="true" focusable="false">
                                                                <path d="M1,9 L1,3.5 C1,2 2,1 3.5,1 L14.5,1 C16,1 17,2 17,3.5 L17,14.5 C17,16 16,17 14.5,17 L3.5,17 C2,17 1,16 1,14.5 L1,9 Z"></path>
                                                                <polyline points="1 9 7 14 15 4"></polyline>
                                                            </svg>
                                                        </label>
                                                        <label id="label-publishPoem" for="publishPoem" class="small m-0" style="cursor:pointer;display:inline-flex;align-items:center;gap:.35rem;color:#6c6c6c;">
                                                            <i class="bi bi-share"></i> Pubblica nella bacheca
                                                        </label>
                                                    </div>
                                                    <div class="d-flex align-items-center gap-2">
                                                        <input type="checkbox" id="useTolerance" class="visually-hidden-checkbox" aria-labelledby="label-useTolerance">
                                                        <label for="useTolerance" class="check" aria-hidden="true">
                                                            <svg width="18" height="18" viewBox="0 0 18 18" aria-hidden="true" focusable="false">
                                                                <path d="M1,9 L1,3.5 C1,2 2,1 3.5,1 L14.5,1 C16,1 17,2 17,3.5 L17,14.5 C17,16 16,17 14.5,17 L3.5,17 C2,17 1,16 1,14.5 L1,9 Z"></path>
                                                                <polyline points="1 9 7 14 15 4"></polyline>
                                                            </svg>
                                                        </label>
                                                        <label id="label-useTolerance" for="useTolerance" class="small m-0" style="cursor:pointer;display:inline-flex;align-items:center;gap:.35rem;color:#6c6c6c;">
                                                            <i class="bi bi-gear"></i> Usa tolleranza
                                                        </label>
                                                        <button type="button"
                                                                id="toleranceInfoBtn"
                                                                class="btn btn-link p-0 m-0 align-middle"
                                                                aria-label="Cosa fà l'opzione tolleranza?"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#toleranceInfoModal"
                                                                style="color: var(--text); text-decoration: none;">
                                                            <i class="bi bi-info-circle"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex gap-2">
                                                <button type="button" class="btn btn-haiku btn-secondary" id="copyBtn">
                                                    <i class="bi bi-clipboard"></i> Copia
                                                </button>
                                                <button type="button" class="btn btn-haiku btn-primary" id="submitBtn" disabled>
                                                    <i class="bi bi-check-circle"></i> <span id="submitBtnText">Verifica</span>
                                                </button>
                                            </div>
                                        </div>
                                        <input type="hidden" name="poemType" id="hiddenPoemType" value="haiku">
                                    </form>

                                    <!-- Risultati -->
                                    <div id="resultContainer" class="mt-4" style="display: none;">
                                        <div class="alert border-0 rounded-4 p-0 overflow-hidden" role="alert" 
                                            style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);">
                                            <div class="p-4">
                                                <h4 class="alert-heading d-flex align-items-center gap-2 mb-3" id="resultTitle">
                                                    <i class="bi"></i>
                                                    <span class="fw-medium"></span>
                                                </h4>
                                                <div class="divider mb-3" style="height: 1px;"></div>
                                                <p id="resultMessage" class="mb-0"></p>
                                            </div>
                                            <div class="syllable-details p-4 pt-0" id="syllableDetails"></div>
                                        </div>
                                    </div>

                                    <script>
                                        // Aggiorna il campo nascosto quando cambia il select
                                        document.getElementById('poemType').addEventListener('change', function() {
                                            document.getElementById('hiddenPoemType').value = this.value;
                                        });
                                        // Evita submit nativo se l'app non è ancora pronta (previene 405)
                                        (function(){
                                            let appReady = false;
                                            document.addEventListener('app:ready', function(){
                                                appReady = true;
                                                const btn = document.getElementById('submitBtn');
                                                if (btn) btn.disabled = false;
                                            }, { once: true });
                                            const form = document.getElementById('poemForm');
                                            if (form) {
                                                form.addEventListener('submit', function(e){
                                                    if (!appReady) {
                                                        e.preventDefault();
                                                    }
                                                });
                                            }
                                        })();
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="bg-haiku-primary text-white py-4 mt-auto">
                <div class="container text-center">
                    <p class="mb-0">Made with <i class="bi bi-heart-fill"></i> by 
                        <a href="https://github.com/aleloizz" class="text-white">aleloizz</a><br>
                        <small><small>dedicato a tutti i poeti innamorati e a tutte le loro muse</small></small><!--dedicato anche ai cuori spezzati-->
                    </p>
                </div>
            </footer>

            <!-- Modals -->
            <div class="modal fade" id="aboutModal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content glass-card border-0 rounded-4 shadow-lg p-0" style="backdrop-filter: blur(16px); background: rgba(255, 255, 255);">
                        <div class="modal-header border-0 pb-0" style="background: linear-gradient(90deg, #a96fff 0%, #ff8f5c 100%); ">
                            <h5 class="modal-title d-flex align-items-center gap-2" style="font-family: 'inter', serif; color: #ffffff;">
                                <i class="bi bi-stars fs-4"></i>
                                Che bello vederti!
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                        </div>
                        <div class="modal-body pt-3 pb-4 px-4" style="font-size: 1.08em;">
                            <div class="text-center mb-3">
                                <img src="{{ url_for('static', filename='favicon-96x96.png') }}?v=1.2" alt="Logo Ale's Haikus" style="width: 48px; height: 48px; border-radius: 12px; box-shadow: 0 2px 12px rgba(160,132,232,0.10); background: #fff;">
                            </div>
                            <p class="mb-3" style="font-family: 'Inter', sans-serif;">
                                Non serve essere poeti per iniziare: su Ale's Haikus basta avere <b>un'emozione</b> da raccontare. Puoi scrivere di ciò che ami, di un momento fugace, di <b>un pensiero</b> che ti attraversa la mente. Anche poche parole possono diventare poesia. <br><br>Non preoccuparti delle regole: la piattaforma ti guiderà passo dopo passo, aiutandoti a dare forma ai tuoi versi in modo naturale e divertente.<br><br>Ogni poesia nasce da un tentativo… e il tuo primo potrebbe sorprenderti.
                            </p>
                            <div class="alert-glass mb-3 d-flex align-items-center gap-2 p-3" style="background: rgba(212,184,255,0.13); border-left: 4px solid #a084e8;">
                                <i class="bi bi-journal-bookmark-fill fs-4 text-accent"></i>
                                <div>
                                    Scopri tutte le forme poetiche nella<br>
                                    <a href="/wiki" class="a">Wiki della poesia</a>!
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <small class="text-muted">
                                    Per segnalazioni: 
                                    <a href="https://github.com/aleloizz" class="a">GitHub</a> 
                                    o Instagram <span class="fw-semibold">@aleloizz</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tolerance Info Modal -->
            <div class="modal fade" id="toleranceInfoModal" tabindex="-1" aria-labelledby="toleranceInfoTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content glass-card border-0 rounded-4 shadow-lg p-0" style="backdrop-filter: blur(16px); background: rgba(255, 255, 255);">
                        <div class="modal-header border-0 pb-0" style="background: linear-gradient(90deg, #a96fff 0%, #ff8f5c 100%); ">
                            <h5 class="modal-title d-flex align-items-center gap-2" id="toleranceInfoTitle" style="font-family: 'inter', serif; color: #ffffff;">
                                <i class="bi bi-info-circle fs-5"></i>
                                Tolleranza sillabe
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                        </div>
                        <div class="modal-body pt-3 pb-4 px-4" style="font-size: 1.02em; color:#4b4b4b;">
                            <p class="mb-2">La poesia risiede nel contenuto, non nella forma.
                                Se abilitata, la verifica metrica accetta una variazione di <strong>±2 sillabe per verso</strong>.</p>
                            <p class="mb-2">Questo consente di mantenere la libertà creativa, pur offrendo un'indicazione generale sulla metrica.</p>
                            <div class="small text-muted">Suggerimento: se hai bisogno di maggiore flessibilità, considera di selezionare la categoria "versi liberi" per evitare ogni vincolo.</div>
                        </div>
                        <div class="modal-footer border-0 pt-0 px-4 pb-4">
                            <button type="button" class="btn btn-haiku btn-primary" data-bs-dismiss="modal">
                                <i class="bi bi-check2"></i> Ho capito
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Modulepreload dependencies to avoid ESM waterfall -->
            <link rel="modulepreload" href="{{ url_for('static', filename='js/utils.js') }}?v=1.3.8">
            <link rel="modulepreload" href="{{ url_for('static', filename='js/storage.js') }}?v=1.3.8">
            <link rel="modulepreload" href="{{ url_for('static', filename='js/patterns.js') }}?v=1.3.8">
            <link rel="modulepreload" href="{{ url_for('static', filename='js/publish.js') }}?v=1.3.8">
            <link rel="modulepreload" href="{{ url_for('static', filename='js/form.js') }}?v=1.3.8">
            <link rel="modulepreload" href="{{ url_for('static', filename='js/validation.js') }}?v=1.3.8">
                        <!-- JavaScript modulare: importa su DOMContentLoaded (con guardia singola), con fallback su prima interazione -->
                        <script type="module">
                            let appLoaded = false;
                            const loadApp = () => {
                                if (appLoaded) return;
                                appLoaded = true;
                                // Cache bust: keep in sync with APP_VERSION inside main.js
                                return import("{{ url_for('static', filename='js/main.js') }}?v=1.3.8");
                            };
                            // Carica non appena il DOM è pronto (non blocca LCP e assicura i listener)
                            if (document.readyState === 'loading') {
                                document.addEventListener('DOMContentLoaded', loadApp, { once: true });
                            } else {
                                loadApp();
                            }
                            // Backup: prima interazione
                            ['click','touchstart','keydown','mousemove'].forEach(ev =>
                                window.addEventListener(ev, loadApp, { once: true, passive: true })
                            );
                        </script>
                        <!-- Lazy-load Bootstrap JS after idle to keep it out of LCP chain -->
                        <script>
                            (function(){
                                function loadBootstrap(){
                                    if (window.bootstrap) return;
                                    var s=document.createElement('script');
                                    s.src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
                                    s.defer=true; s.crossOrigin='anonymous';
                                    document.head.appendChild(s);
                                }
                                if ('requestIdleCallback' in window) {
                                    requestIdleCallback(loadBootstrap, {timeout: 2000});
                                } else {
                                    window.addEventListener('load', function(){ setTimeout(loadBootstrap, 1500); });
                                }
                                // Ensure modal opens if user clicks before Bootstrap JS is present
                                document.addEventListener('click', function(e){
                                    const btn = e.target.closest('#toleranceInfoBtn');
                                    if (!btn) return;
                                    if (!window.bootstrap) {
                                        loadBootstrap();
                                        // Try opening after a short delay
                                        setTimeout(function(){
                                            const modalEl=document.getElementById('toleranceInfoModal');
                                            if (modalEl && window.bootstrap && bootstrap.Modal) {
                                                new bootstrap.Modal(modalEl).show();
                                            }
                                        }, 350);
                                    }
                                }, { passive: true });
                            })();
                        </script>
        </div>
    <script defer src="{{ url_for('static', filename='js/pwa-install.js') }}?v=1.5"></script>
    </body>
</html>